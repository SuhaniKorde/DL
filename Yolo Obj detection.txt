import os
from ultralytics import YOLO
import cv2
from matplotlib import pyplot as plt

# Step 1: Create YAML
yaml_text = """\
train: C:\\Users\\vbors\\OneDrive\\Desktop\\Pract5\\Practical-6\\data\\train\\images
val: C:\\Users\\vbors\\OneDrive\\Desktop\\Pract5\\Practical-6\\data\\val\\images
test: C:\\Users\\vbors\\OneDrive\\Desktop\\Pract5\\Practical-6\\data\\test\\images

nc: 4
names: ['airplane', 'car_side', 'chair', 'cup']
"""

yaml_path = r"C:\Users\vbors\OneDrive\Desktop\Pract5\Practical-6\data.yaml"
with open(yaml_path, "w") as f:
    f.write(yaml_text)

print("âœ… data.yaml created successfully!")

# Step 2: Load YOLO model
model = YOLO("yolov8n.pt")

# Step 3: Train
model.train(
    data=yaml_path,
    epochs=5,
    imgsz=640,
    batch=8
)

# Step 4: Predict
results = model.predict(
    source=r"C:\Users\vbors\OneDrive\Desktop\Pract5\Practical-6\data\test\images\image_0052.jpg",
    save=True
)

# Step 5: Display the output image
output_path = results[0].save_dir / results[0].path.name
img = cv2.imread(str(output_path))
img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)

plt.figure(figsize=(8, 8))
plt.imshow(img)
plt.axis('off')
plt.title("YOLOv8 Detection Output")
plt.show()

print("ðŸ“‚ Output saved at:", results[0].save_dir)
